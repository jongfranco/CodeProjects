# Filename: makefile
# Description:  This is the makefile used to compile a simplified BitTorrent protocol.
#
# Author: Kristin Dahl
# Date: 3-2-2015
 
CLIENT_OBJECTS = client.o tstore_client.o trkr_client.o nod_client.o tstore_clnt.o tstore_xdr.o trkr_clnt.o trkr_xdr.o nod_clnt.o nod_xdr.o

CC = gcc
CFLAGS = -g -DRPC_SVC_FG

all: client torrent_store_server tracker_server node_server;


# The executables: client torrent_store_server tracker_server node_server

client: $(CLIENT_OBJECTS)
	$(CC) -o client $(CLIENT_OBJECTS) -lnsl

torrent_store_server: tstore_server.o tstore_svc.o tstore_xdr.o
	$(CC) -o torrent_store_server tstore_server.o tstore_svc.o tstore_xdr.o -lnsl

tracker_server: trkr_server.o nod_client.o tstore_clnt.o trkr_svc.o trkr_xdr.o nod_clnt.o nod_xdr.o 
	$(CC) -o tracker_server trkr_server.o nod_client.o tstore_clnt.o trkr_svc.o trkr_xdr.o nod_clnt.o nod_xdr.o -lnsl


node_server: nod_server.o trkr_clnt.o trkr_xdr.o nod_svc.o nod_xdr.o
	$(CC) -o node_server nod_server.o trkr_clnt.o trkr_xdr.o nod_svc.o nod_xdr.o -lnsl

    
# Object files for the executables

client.o: client.c trkr.h tstore.h nod.h
	$(CC) $(CFLAGS) -c client.c

tstore_client.o: tstore_client.c tstore.h trkr.h
	$(CC) $(CFLAGS) -c tstore_client.c

tstore_server.o: tstore_server.c tstore.h trkr.h
	$(CC) $(CFLAGS) -c tstore_server.c

	
trkr_client.o: trkr_client.c trkr.h tstore.h nod.h
	$(CC) $(CFLAGS) -c trkr_client.c

trkr_server.o: trkr_server.c trkr.h tstore.h nod.h
	$(CC) $(CFLAGS) -c trkr_server.c

	
nod_client.o: nod_client.c nod.h trkr.h
	$(CC) $(CFLAGS) -c nod_client.c

nod_server.o: nod_server.c nod.h trkr.h
	$(CC) $(CFLAGS) -c nod_server.c 
	

# Compile files generated by rpcgen

tstore_clnt.o: tstore_clnt.c tstore.h
	$(CC) $(CFLAGS) -c tstore_clnt.c
tstore_svc.o: tstore_svc.c tstore.h
	$(CC) $(CFLAGS) -c tstore_svc.c
tstore_xdr.o: tstore_xdr.c tstore.h
	$(CC) $(CFLAGS) -c tstore_xdr.c
	
trkr_svc.o: trkr_svc.c trkr.h
	$(CC) $(CFLAGS) -c trkr_svc.c
trkr_clnt.o: trkr_clnt.c trkr.h
	$(CC) $(CFLAGS) -c trkr_clnt.c
trkr_xdr.o: trkr_xdr.c trkr.h
	$(CC) $(CFLAGS) -c trkr_xdr.c

nod_svc.o: nod_svc.c nod.h
	$(CC) $(CFLAGS) -c nod_svc.c
nod_clnt.o: nod_clnt.c nod.h
	$(CC) $(CFLAGS) -c nod_clnt.c
nod_xdr.o: nod_xdr.c nod.h
	$(CC) $(CFLAGS) -c nod_xdr.c

clean:
	rm -f client torrent_store_server tracker_server node_server *.o

